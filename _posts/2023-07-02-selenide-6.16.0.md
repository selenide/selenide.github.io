---
layout: post
title: "Вышла Selenide 6.16.0"
description: ""
category:
header-text: "Фарш справедливости"
tags: []
---
{% include JB/setup %}

Доброй ночи!

> TODO  


Мы выпустили [Selenide 6.16.0](https://github.com/selenide/selenide/milestone/185?closed=1) 
* [Ускорили проверки коллекций](#speedup-collection-checks)
* [Улучшили сообщение об ошибках в коллекциях](#improve-collections-error-messages)
* [Новые проверки для дат `date(...)` и `datetime(...)`](#new-date-checks)
* [Новые методы для установки времени](#set-date-time-value)
* [Полный стектрейс в софт ассертах](#full-stacktrace-in-soft-asserts)
* [BasicAuth в браузерах Chromium](#improve-basic-auth-in-chromium-browsers)
* [Несколько доменов в BasicAuth](#multiple-domains-in-basic-auth)
* [Исправили `$.doubleClick()` в Appium](#fix-double-click-in-appium)
* [Снимаем скриншот чуть раньше](#screenshot-before-after-each)
* [Обновили зависимости](#update-dependencies)
* [Новости](#news)
  {: .blogpost-menu}
  <br>

### Ускорили проверки коллекций {#speedup-collection-checks}

Вот это крутизна!

Как вы знаете, одна из базовых возможностей в Селениде - это проверки коллекций. Одной строчкой можно проверить сразу кучу элементов:

```java
$$(".number").shouldHave(texts("One", "Two", "Three", "Four", "Five"))
$$(".number").shouldHave(attributes("value", "one", "two", "three", "four", "five"))
```

Однако такая проверка занимает время, если коллекция достаточно большая (если на странице 1000 элементов `.number`, 
на моей резвой лошадке она занимает почти 3 секунды). Медленность обусловлена тем, что Селенид спрашивает у браузера 
текст (или атрибут) каждого элемента по отдельности. 1000 вызовов вебдрайвера (даже очень быстрых) - это долго.

Ну вот, мы решили ускорить эти проверки. 
Теперь Селенид запрашивает тексты всех 1000 элементов за один вызов вебдрайвера - с помощью JavaScript.
Упомянутая выше проверка вместо 3 секунд теперь занимает 200 мс. Ну очуметь же!

P.S. Для Appium и других возможных вебдрайверов, которые не поддерживают JS, остаётся старый вариант (который 
запрашивает тексты по одному). Что поделать. Хотя бы не стало хуже.  

См. [PR 2362](https://github.com/selenide/selenide/pull/2362).

<br>

### Улучшили сообщение об ошибках в коллекциях {#improve-collections-error-messages}

В рамках предыдущей переделки проверок для коллекций мы чутка утонили и сообщения об ошибках. Теперь Селенид
точнее говорит, какой именно элемент коллекции не совпал. 

Например, вот такая проверка:

```java
$$(".number").shouldHave(exactTexts("On", "Tw", "Thre"))
```

Раньше выдавала просто "Texts mismatch":
```java
Texts mismatch
Actual: [One, Two, Three]
Expected: [On, Tw, Thre]
```

А теперь первая строка содержит более точное указание, что именно не совпало: 
```java
Text #0 mismatch (expected: "On", actual: "One")
Actual: [One, Two, Three]
Expected: [On, Tw, Thre]
```

См. [PR 2362](https://github.com/selenide/selenide/pull/2362).

<br>

### Новые проверки для дат `date(...)` и `datetime(...)` {#new-date-checks}

```java
import static com.codeborne.selenide.conditions.datetime.DateConditionOptions.*;

LocalDate birthday = LocalDate.of(2022, 10, 11);
$("#birthdate").shouldHave(date(birthday));
$("#birthdate").shouldHave(date(birthday, "yyyy-MM-dd"));
$("#birthdate").shouldHave(dateBetween(parse("2020-01-01"), parse("2023-12-31")));
$("#birthdate").shouldHave(dateFormat("yyyy-MM-dd"));
```

См. [issue 2268](https://github.com/selenide/selenide/issues/2268).
Спасибо [Maksim @Au6ojlut](https://github.com/Au6ojlut) за [PR 2281](https://github.com/selenide/selenide/pull/2281).

<br>

### Новые методы для установки времени {#set-date-time-value}

В селениде уже был метод для установки даты (`withDate`):

```java
$("#birthdate").setValue(withDate(LocalDate.of(...)));
// для <input type="date">
```

Теперь же мы добавили похожие методы для установки даты с временем (`withDateTime`):
```java
$("#birthdate").setValue(withDateTime(LocalDateTime.of(...)));
// для <input type="datetime-local">
```

либо только времени (`withTime`):
```java
$("#openFrom").setValue(withTime(LocalTime.of(7, 12)));
$("#closeFrom").setValue(withTime(LocalTime.of(17, 59, 58)));
// для <input type="time">
```
См. [PR 2357](https://github.com/selenide/selenide/pull/2357).

<br>

### Полный стектрейс в софт ассертах {#full-stacktrace-in-soft-asserts}

В Селениде уже давно есть софт ассерты. (При включении этого режима) при падении нескольких проверок Селенид кидает 
ошибку не сразу, а лишь в конце теста. И в этой ошибке перечисляются все Assertion error. 

Вопрос в том, что для этих ошибок Селенид показывал не полный стектрейс, и там не была видна часть "Caused by:". 
Теперь будет видна. 
Будьте готовы к тому, что длина стектрейсов резко вырастет. :)

См. [issue 2350](https://github.com/selenide/selenide/issues/2350) и [PR 2354](https://github.com/selenide/selenide/pull/2354).

<br>

### Улучшили BasicAuth в браузерах семейства Chromium {#improve-basic-auth-in-chromium-browsers}

В Селениде есть методы для авторизации на странице через BasicAuth:
```java
open("/basic-auth/hello", "my.test.com", "scott", "pwd123");
```
До сих пор было две реализации BasicAuth.
1. При включённом прокси: Селенид добавляет к запросу заголовок `Authorization`
2. При выключённом прокси: Селенид добавляет логин и пароль в URL.

Теперь к ним добавился третий вариант:
Если вебдрайвер реализует интерфейс `org.openqa.selenium.HasAuthentication`, Селенид добавляет логин+пароль через него.
Фактически это означает браузеры семейства Chromium (Chrome, Chromium, Edge).

См. [issue 2336](https://github.com/selenide/selenide/issues/2336) и [PR 2358](https://github.com/selenide/selenide/pull/2358).

<br>

### Несколько доменов в BasicAuth {#multiple-domains-in-basic-auth}
До сих пор можно было прописать только один домен для BasicAuth:
```java
open("/basic-auth/hello", "my.test.com", "scott", "pwd123");
```

Это не помогает, если в тестируемом приложении задействовано несколько доменов - например, оно открывает фреймы с адресом
`auth.test.com` или там `api.test.com`. Всегда можно прописать пустую строку вместо домена, но у этого варианта есть
[очевидные минусы](/2022/10/07/selenide-6.9.0/#secure-authorization-header).

Теперь можно прописать несколько доменов через запятую или "|":
```java
open("/basic-auth/hello", "my.test.com|auth.test.com|api.test.com", 
          "scott", "pwd123");
```

См. [PR 2358](https://github.com/selenide/selenide/pull/2358).

P.S. Естественно, имя домена не используется, когда Селенид добавляет логин+пароль просто в URL.

<br>

### Исправили `$.doubleClick()` в Appium {#fix-double-click-in-appium}

В предыдущем релизе мы сломали, а теперь починили двойной клик в мобильниках:
```java
$(AppiumBy.xpath(".//android.widget.CheckBox")).doubleClick();
```

См. [issue 2346](https://github.com/selenide/selenide/issues/2346) и [PR 2347](https://github.com/selenide/selenide/pull/2347).

<br>

### Снимаем скриншот чуть раньше {#screenshot-before-after-each}
Обычно Селенид автоматически делает скриншот в случае падения теста. 
НО
Если вы закрывали браузер в методе `@AfterEach`, то Селенид уже не мог сделать скриншот:
```java
@AfterEach
void tearDown() {
  Selenide.closeWebDriver();
}
```

Теперь Селенид будет делать скриншот чуть раньше - ДО методов `@AfterEach`.

См. [issue 2352](https://github.com/selenide/selenide/issues/2352) и [PR 2356](https://github.com/selenide/selenide/pull/2356).

<br>

### Обновили зависимости {#update-dependencies}
* [2319](https://github.com/selenide/selenide/pull/2318) use latest version of geckodriver for FF 102+
* [2328](https://github.com/selenide/selenide/pull/2328) bump Selenium from 4.9.1 to 4.10.0
* [2324](https://github.com/selenide/selenide/pull/2324) Bump io.appium:java-client from 8.5.0 to 8.5.1
* [2349](https://github.com/selenide/selenide/pull/2349) Bump Netty from 4.1.93.Final to 4.1.94.Final
* bump WebDriverManager from 5.3.3 to 5.4.0

<br>

### Новости {#news}

* Пост [Page Object – простой пример с использованием Selenide](https://www.it-notes.wiki/automation-testing/page-object-simple-example-using-selenide/) на IT-notes
* Видос [Run Selenide Appium Test in LambdaTest](https://www.youtube.com/watch?v=zAhCLLX9IOc&ab_channel=TestingMiniBytes) в блоге "Testing Mini Bytes"
* TODO

<br>


[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
